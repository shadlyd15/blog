I"┐.<p>ржПржмрж╛рж░ ржЖржорж░рж╛ ржирж┐ржЬрзЗржжрзЗрж░ ржЬржирзНржп ADC рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржирж┐ржЬрзЗрж░рж╛ржЗ рждрзИрж░рж┐ ржХрж░ржмрзЛред ржЖржорж╛ржжрзЗрж░ ржирж┐ржЬрзЗржжрзЗрж░ рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ рждрзИрж░рж┐рж░ ржЙржжрзНржжрзЗрж╢рзНржп рж╣рж▓ ржЖржорж╛ржжрзЗрж░ ржпрж╛рждрзЗ ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ ржЖрж▓рж╛ржжрж╛ ржЖрж▓рж╛ржжрж╛ ржХрж╛ржЬрзЗрж░ ржЬржирзНржп ржПржХржЗ ржЬрж┐ржирж┐рж╕ ржмрж╛рж░ржмрж╛рж░ ржпрзЗржи рж▓рзЗржЦрж╛ ржирж╛ рж▓рж╛ржЧрзЗред ржПржХржЗ ржЬрж┐ржирж┐рж╕ ржмрж╛рж░ржмрж╛рж░ рж▓рзЗржЦрж╛ржЯрж╛ рж╕рждрзНржпржЗ ржЦрзБржм ржмрж┐рж░ржХрзНрждрж┐ржХрж░ред рждрзЛ ржЖрж░ ржХржерж╛ ржирж╛ ржмрж╛рзЬрж┐рзЯрзЗ ржХрж╛ржЬрзЗ ржирзЗржорзЗ ржпрж╛ржЗ ржХрж┐ ржмрж▓ ?</p>

<p>ржкрзНрж░ржержорзЗ adc.c ржПржмржВ adc.h ржирж╛ржорзЗрж░ ржжрзБржЯрж┐ ржлрж╛ржЗрж▓ рждрзИрж░рж┐ ржХрж░рж┐ред ржЖржорж░рж╛ ржжрзБржЯрж┐ ржлрж╛ржВрж╢ржи рждрзИрж░рж┐ ржХрж░ржмред ржПржХржЯрж╛рждрзЗ ржерж╛ржХржмрзЗ рж╢рзБржзрзБ ADC ржХрзЗ Prescaler ржЗржиржкрзБржЯ ржжрж┐рзЯрзЗ Initialize ржХрж░рж╛рж░ ржЬржирзНржпред ржЖрж░рзЗржХржЯрж╛ ржерж╛ржХржмрзЗ ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ ржкрж┐ржи ржирж╛ржорзНржмрж╛рж░ ржжрж┐рзЯрзЗ ADC Value ржЬрж╛ржирж╛рж░ ржЬржирзНржпред</p>

<p>adc.c ржлрж╛ржЗрж▓рзЗ ржЖржорж░рж╛ ReadADC ржлрж╛ржВрж╢ржиржЯрж╛ рждрзИрж░рж┐ ржХрж░рзЗ ржПржнрж╛ржмрзЗред</p>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>
<span class="kt">uint16_t</span> <span class="nf">ReadADC</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">pin</span><span class="p">){</span>
	<span class="n">ADMUX</span><span class="o">|=</span><span class="n">pin</span><span class="p">;</span>
	<span class="n">ADCSRA</span><span class="o">|=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADSC</span><span class="p">);</span>
	<span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ADCSRA</span>  <span class="o">&amp;</span>  <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADIF</span><span class="p">)));</span>
	<span class="n">_delay_ms</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
	<span class="k">return</span><span class="p">(</span><span class="n">ADCW</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>ржПржЦрж╛ржирзЗ ржлрж╛ржВрж╢ржиржЯрж┐рж░ ржЖрж░рзНржЧрзБржорзЗржирзНржЯ ржжрзЗрзЯрж╛ рж╣рзЯрзЗржЫрзЗ ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ ржпрзЗ ржкрж┐ржи ржжрж┐рзЯрзЗ ADC Input ржирж┐ржмрзЛ рждрж╛рж░ ржкрж┐ржи ржиржорзНржмрж░ред ржПржЦржи ржПржЗ ржкрж┐ржи ржирж╛ржорзНржмрж╛рж░рзЗрж░ ржЬржирзНржп ADMUX ржПрж░ ржмрж┐ржЯржЧрзБрж▓рзЛ High ржХрж░рзЗ ржжрзЗржЗред ржХржиржнрж╛рж░рзНрж╕ржи рж╢рзБрж░рзБ ржХрж░рж┐ред рждрж╛рж░ржкрж░ ржХржиржнрж╛рж░рзНрж╕ржи рж╢рзЗрж╖ рж╣ржУрзЯрж╛ ржкрж░рзНржпржирзНржд ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рж┐ред ржпрзЗрж╣рзЗрждрзБ ADIF ржХржиржнрж╛рж░рзНрж╕ржи рж╢рзЗрж╖рзЗ ржирж┐ржЬрзЗ ржирж┐ржЬрзЗржЗ High рж╣рзЯ ржпрж╛рзЯ рждрж╛ржЗ ржЖржорж░рж╛ ржЪрзЗржХ ржХрж░ржмрзЛ ржПржЯрж┐ ржПржЦржиржУ Low ржЖржЫрзЗ ржХрж┐ржирж╛ред Low ржерж╛ржХрж╛ ржЕржмрж╕рзНржерж╛ ржкрж░рзНржпржирзНржд ржЖржорж░рж╛ ржПржЦрж╛ржирзЗржЗ ржерж╛ржоржмрзЛ рждрж╛ржЗ ржПржЦрж╛ржирзЗ ржПржХржЯрж┐ Infinite рж▓рзБржк рждрзИрж░рж┐ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗред ржХржиржнрж╛рж░рзНрж╕ржи рж╢рзЗрж╖рзЗ ржирж┐ржЬрзЗ ржерзЗржХрзЗржЗ рж▓рзБржк ржерзЗржХрзЗ ржмрзЗрж░ рж╣рзЯрзЗ ржЖрж╕ржмрзЗред ржХрж┐ржЫрзБржХрзНрж╖ржг ржУрзЯрзЗржЯ ржХрж░рж┐ ржпрж╛рждрзЗ ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ CPU Overload ржирж╛ рж╣рзЯрзЗ ржпрж╛рзЯред рж╕ржорзНржкрзВрж░рзНржг ADC Value ржЯрж┐ ADCW ржжрж┐рзЯрзЗ рж░рж┐ржЯрж╛рж░рзНржи ржХрж░рж┐ред</p>

<p>ржПржЦржи ржЖрж╕рж┐  <strong>SetupADC()</strong>  ржлрж╛ржВрж╢ржирзЗред ржлрж╛ржВрж╢ржиржЯрж┐рждрзЗ ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ ADC ржПрж░ ржнрзЛрж▓рзНржЯрзЗржЬ рж░рзЗржлрж╛рж░рзЗржирзНрж╕ рж╕рзЗржЯ ржХрж░рж┐ред рждрж╛рж░ржкрж░ ржмрж┐ржнрж┐ржирзНржи Prescaler ржПрж░ ржЬржирзНржп ржмрж┐ржнрж┐ржирзНржиржнрж╛ржмрзЗ ADCSRA рж╕рзЗржЯ ржХрж░рзЗ if ржХржирзНржбрж┐рж╢ржи ржжрж┐рзЯрзЗ ржЖрж▓рж╛ржжрж╛ ржХрж░рзЗ ржжрзЗржЗред ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ ADC ржПржирж╛ржмрж▓ ржХрж░рзЗ ржжрзЗржЗред ржмрзНржпрж╛рж╕ рждрзИрж░рж┐ рж╣рзЯрзЗ ржЧрзЗрж▓рзЛ ржЖржорж╛ржжрзЗрж░ ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ ржЬржирзНржп ржЧрж░ржо ржЧрж░ржо ADC рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ред  <strong>SetupADC()</strong>  ржлрж╛ржВрж╢ржирзЗрж░ ржЖрж░рзНржЧрзБржорзЗржирзНржЯрзЗ ржЖржорж░рж╛ ржпрзЗ Prescaler ржЪрж╛ржЗ рждрж╛ ржжрж┐рж▓рзЗржЗ рж╕рзЗ ржЕржирзБржпрж╛рзЯрзА Prescaler рж╕рзЗржЯ рж╣рзЯрзЗ ржпрж╛ржмрзЗред</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kt">void</span>  <span class="nf">SetupADC</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">presclr</span><span class="p">){</span>
	<span class="n">ADMUX</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">REFS0</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">presclr</span><span class="o">==</span><span class="mi">128</span><span class="p">)</span>
		<span class="n">ADCSRA</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS2</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS0</span><span class="p">);</span>
	<span class="k">else</span>  <span class="k">if</span><span class="p">(</span><span class="n">presclr</span><span class="o">==</span><span class="mi">64</span><span class="p">)</span>
		<span class="n">ADCSRA</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS2</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS1</span><span class="p">);</span>
	<span class="k">else</span>  <span class="k">if</span><span class="p">(</span><span class="n">presclr</span><span class="o">==</span><span class="mi">32</span><span class="p">)</span>
		<span class="n">ADCSRA</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS2</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS0</span><span class="p">);</span>
	<span class="k">else</span>  <span class="k">if</span><span class="p">(</span><span class="n">presclr</span><span class="o">==</span><span class="mi">16</span><span class="p">)</span>
		<span class="n">ADCSRA</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS2</span><span class="p">);</span>
	<span class="k">else</span>  <span class="k">if</span><span class="p">(</span><span class="n">presclr</span><span class="o">==</span><span class="mi">8</span><span class="p">)</span>
		<span class="n">ADCSRA</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS1</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS0</span><span class="p">);</span>
	<span class="k">else</span>  <span class="k">if</span><span class="p">(</span><span class="n">presclr</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span>
		<span class="n">ADCSRA</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS1</span><span class="p">);</span>
	<span class="k">else</span>  <span class="k">if</span><span class="p">(</span><span class="n">presclr</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">ADCSRA</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS0</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">ADCSRA</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADPS0</span><span class="p">);</span>
	<span class="n">ADCSRA</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">ADEN</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>рж╢рзБржзрзБ рждрзЛ ржЖрж░ рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ рждрзИрж░рж┐ ржХрж░рж▓рзЗржЗ ржЪрж▓ржмрзЗ ржирж╛, ржПржХрзЗ ржХрж╛ржЬрзЗржУ рж▓рж╛ржЧрж╛рждрзЗ рж╣ржмрзЗред ржПржЦржи ржЖржорж░рж╛ ржПржЗ рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ADC рж░рж┐ржбрж┐ржВ ржирж┐ржмрзЛред ржПржЦржи ржЖржорж░рж╛ ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ AVCC ржкрж┐ржирзЗ 5V ржПржмржВ AGND ржкрж┐ржиржХрзЗ ржЧрзНрж░рж╛ржЙржирзНржб ржХрж░рзЗ ржжрзЗржЗред ржПржЯрж╛ ржХрж░рж▓рзЗ ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ ржнрзЗрждрж░рзЗрж░ ржПржирж╛рж▓ржЧ ржХржорзНржкрзНржпрж╛рж░рзЗржЯрж░ ржЪрж╛рж▓рзБ рж╣рзЯрзЗ ржпрж╛ржмрзЗред ржПржЦржи ржЖржорж╛рж░рж╛ ржХрж╛ржЬрзЗрж░ ржзрж░ржи ржЕржирзБржпрж╛рзЯрзА ADC ржПрж░ ржмрж┐ржнрж┐ржирзНржи ржорзЛржб ржарж┐ржХ ржХрж░рзЗ ржирж┐ржмред ржЖржорж░рж╛ ржПржЦрж╛ржирзЗ тАЬAVCC with external capacitor at AREF pinтАЭ ржПржЗ ржорзЛржбрзЗ ржХрж╛ржЬ ржХрж░ржмред ржПржЗ ржорзЛржбрзЗ ADC ржПрж░ рж░рзЗржлрж╛рж░рзЗржирзНрж╕ ржнрзЛрж▓рзНржЯрзЗржЬ рж╣рж▓ AVCC ржЕрж░рзНржерж╛рзО 5Vред ржПржЗ ржорзЛржбрзЗ ADC ржирж┐рзЯрзЗ ржХрж╛ржЬ ржХрж░рждрзЗ рж╣рж▓рзЗ ржорж╛ржЗржХрзНрж░рзЛржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░ ржПрж░ AVCC ржПржмржВ AREF ржкрж┐ржирзЗрж░ ржорж╛ржЭрзЗ ржПржХржЯрж┐ ржХрзНржпрж╛ржкрж╛рж╕рж┐ржЯрж░ рж▓рж╛ржЧрж╛рждрзЗ рж╣ржмрзЗред</p>

<p><a href="https://web.archive.org/web/20150405105824/http://d15tech.com/wp-content/uploads/2015/01/adc-value1.jpg"><img src="https://web.archive.org/web/20150405105824im_/http://d15tech.com/wp-content/uploads/2015/01/adc-value1.jpg" alt="adc-value" /></a></p>

<p>рж╕рж╛ржзрж╛рж░ржгржд 0.1 mF (104) ржХрзНржпрж╛ржкрж╛рж╕рж┐ржЯрж░ рж▓рж╛ржЧрж╛рж▓рзЗржЗ ржХрж╛ржЬ рж╣рзЯрзЗ ржпрж╛рзЯред ржПржЦржи ржЖржорж░рж╛ ржпрзЗ ADC Channel рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░ржм рж╕рзЗржЗ ржкрж┐ржирзЗ ржПржХржЯрж┐ ржкржЯрзЗржирж╢рж┐ржУржорж┐ржЯрж╛рж░рзЗрж░ ржорж╛ржЭржЦрж╛ржирзЗрж░ ржкрж┐ржиржЯрж┐ рж▓рж╛ржЧрж┐рзЯрзЗ ржжрж┐ржмред ржкржЯрзЗржирж╢рж┐ржУржорж┐ржЯрж╛рж░рзЗрж░ ржмрж╛ржХрж┐ ржкрж┐ржиржжрзБржЯрж┐рж░ ржПржХржЯрж┐ VCC ржПржмржВ ржЕржкрж░ржЯрж┐ GND рждрзЗ рж▓рж╛ржЧрж┐рзЯрзЗ ржжрж┐ржмред ржПржЦржи ADC Value LCD рждрзЗ ржжрзЗржЦрж╛ржирзЛрж░ ржЬржирзНржп ржХрж┐ржЫрзБ ржХрзЛржб рж▓рж┐ржЦрзЗ рж░рж╛ржи ржХрж░ржмрзЛред ржпржжрж┐ рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХ ржерж╛ржХрзЗ рждржмрзЗ ржкржЯрзЗржирж╢рж┐ржУржорж┐ржЯрж╛рж░рзЗрж░ ржиржм ржШрзБрж░рж╛рж▓рзЗ рж╕рзЗржЗ ржЕржирзБржпрж╛рзЯрзА ADC Value ржкрж░рж┐ржмрж░рзНрждржи рж╣ржмрзЗ ржПржмржВ рждрж╛ LCD рждрзЗ ржжрзЗржЦрж╛ржмрзЗред</p>
:ET